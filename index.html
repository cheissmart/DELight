<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DELight!</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <script>
    var stage = 1;
    var board = new Array();
    var index = new Array();
    var r_size = 5;
    var c_size = 5;
    var question_size = 5;
    var size = r_size * c_size;
    var num_on_bulbs = 0;

    var bulb_start = new Array();
    bulb_start[0] = '<img src="off.png" class="off_bulb" id="';
    bulb_start[1] = '<img src="on.png" class="on_bulb" id="';
    var img_end = '/>';

    var node_list = new Array();
    var base = ( r_size > c_size ) ? r_size : c_size ;

    for (var r = 0; r < r_size; ++r) {
            board[r]= new Array();
            index[r] = new Array()
            var idx = 'row' + r;
            for( var c = 0 ; c < c_size ; ++c){
                node_list[ r * c_size + c ] = ( r * base + c  );
                board[r][c] = false;
                index[r][c] = new Array();
                for(var on = 0 ; on < 2 ; on++ )
                {
                    index[r][c][on] = idx + "col" + c + '_' + on;
                }
            }
        }


    function press( r , c  ){
            for(var i = r-1 ; i <= (r+1) ; i++ ){
                if( i >= 0 && i < r_size){
                    for(var j = c-1 ; j <= (c+1) ; j++ ){
                        if( j >= 0 && j < c_size ){
                            board[i][j] = !board[i][j];
                            for(var on = 0; on < 2 ; on++ )
                                $( "#" + index[i][j][on] ).toggle();
                            if(board[i][j]){
                                num_on_bulbs++;
                            }
                            else{
                                num_on_bulbs--;
                            }
                        }
                    }
                }
            }
        }

    function float2int( val ){
        return val | 0;
    }

    function random_question( q_size ){
        for( var i = 0 ; i < q_size ; i++ )
        {
            var rn = i + float2int( Math.random() * ( size - i ) ) ;
            var t = node_list[i] ;
            node_list[i] = node_list[rn] ;
            node_list[rn] = t;

            press( float2int( node_list[i] / base ) , node_list[i] % base );
        }
    
        $("#stage").text("Stage " + (stage++) );
    }

    var pop = $("#pop")[0] ;
    function once_click( r , c)
    {
       press( r , c );
       pop.play();
       if(num_on_bulbs==0){
           alert('You Win!  "Genius"');
           random_question( question_size );
       }
    }


    $(document).ready(function(){
        pop = $("#pop")[0] ;

        for( var r = 0 ; r < r_size ; r++ )
        {
            var cur_row = "<tr>";
            for( var c = 0 ; c < c_size ; c++ )
            {
                cur_row += '<td>';

                for( var on = 0 ; on < 2 ; on++ )
                    cur_row += bulb_start[on] + index[r][c][on] + '" onclick="once_click(' + r + ',' + c + ')"' + img_end ; 

                cur_row += "</td>" ;
            }
            cur_row += "</tr>";

            $("#Board").append( cur_row );

            for( var c = 0 ; c < c_size ; c++ )
                $( "#" + index[r][c][1] ).toggle();

        }

        while( num_on_bulbs == 0 )
            random_question( question_size );

    });

    </script>
    
    <audio id="pop">
        <source src="pop.wav" type="audio/wav">
    </audio>

    <div id="title">DELight!</div>
    <div id="author">by prpr</div>
    <div align="center">
        <p id="stage"></p>
        <table border="1" id="Board">
        </table>
    </div>
    <br/>
    <div class="credit">
        inspiration:<br/>
        TXAO_MI<br />
        <br/>
        technical support:<br/>
        Emma<br/>
        JefferySAC<br />
        <s>Big-Middle</s>Da-Jhong Lin<br />
        <br/>
        resources:<br/>
        <a href="https://openclipart.org/detail/220988/light-bulb-on-off">light bulb image</a> by <a href="https://openclipart.org/user-detail/bartovan">bartovan</a><br />
        <a href="https://www.google.com/search?q=how+to+wtrie+html%2C+css%2C+javascirpt+...+random+meme">everything i need</a> by <a href="https://www.google.com/">an informative teacher</a><br/>
    </div>

</body>
</html>
